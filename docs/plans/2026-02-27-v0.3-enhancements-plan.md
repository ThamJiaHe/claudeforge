# ClaudeForge v0.3 Enhancements Implementation Plan

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Add security page, Ko-Fi donation integration, footer redesign, changelog page, GitHub star badge, and UI fixes to ClaudeForge v0.3.

**Architecture:** Static pages (security, changelog) built as Next.js App Router server components. Ko-Fi integration uses `react-kofi` client components. Footer redesigned as 3-column responsive grid. GitHub stars fetched client-side with caching. All components follow existing shadcn/ui + Tailwind v4 patterns.

**Tech Stack:** Next.js 16, React 19, Tailwind CSS v4, shadcn/ui, Vitest, `react-kofi`

**Design Doc:** `docs/plans/2026-02-27-v0.3-enhancements-design.md`

---

### Task 1: Set Up Component Testing Infrastructure

**Files:**
- Modify: `package.json` (add dev dependencies)
- Modify: `vitest.config.ts` (add jsdom environment)
- Create: `src/test/setup.ts`

**Step 1: Install testing dependencies**

Run:
```bash
npm install -D @testing-library/react @testing-library/jest-dom jsdom
```
Expected: Clean install, no peer dep errors

**Step 2: Update vitest config for jsdom**

Update `vitest.config.ts`:
```ts
import { defineConfig } from 'vitest/config';
import path from 'path';

export default defineConfig({
  test: {
    globals: true,
    environment: 'jsdom',
    setupFiles: ['./src/test/setup.ts'],
  },
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src'),
    },
  },
});
```

**Step 3: Create test setup file**

Create `src/test/setup.ts`:
```ts
import '@testing-library/jest-dom';
```

**Step 4: Verify setup works**

Run: `npx vitest run --passWithNoTests`
Expected: PASS (no tests yet, exits cleanly)

**Step 5: Commit**

```bash
git add package.json package-lock.json vitest.config.ts src/test/setup.ts
git commit -m "chore: add React Testing Library + jsdom for component tests"
```

---

### Task 2: Create security.txt and SECURITY.md

**Files:**
- Create: `public/.well-known/security.txt`
- Create: `SECURITY.md`

**Step 1: Create security.txt**

Create `public/.well-known/security.txt`:
```
Contact: https://github.com/ThamJiaHe/claudeforge/security/advisories/new
Expires: 2027-02-27T00:00:00.000Z
Preferred-Languages: en
Canonical: https://claudeforge.vercel.app/.well-known/security.txt
Policy: https://claudeforge.vercel.app/security
```

**Step 2: Create SECURITY.md**

Create `SECURITY.md`:
```markdown
# Security Policy

## Reporting a Vulnerability

If you discover a security vulnerability in ClaudeForge, please report it responsibly through [GitHub Private Vulnerability Reporting](https://github.com/ThamJiaHe/claudeforge/security/advisories/new).

**Do not** open a public issue for security vulnerabilities.

## Response Timeline

- **Acknowledgment**: Within 5 business days
- **Resolution target**: 90 days

## Scope

**In scope:** claudeforge.vercel.app, this GitHub repository

**Out of scope:** Third-party services, Supabase infrastructure, Vercel platform

## More Information

See our full [security policy](https://claudeforge.vercel.app/security) for details including safe harbor provisions.
```

**Step 3: Verify files exist**

Run: `ls public/.well-known/security.txt SECURITY.md`
Expected: Both files listed

**Step 4: Commit**

```bash
git add public/.well-known/security.txt SECURITY.md
git commit -m "docs: add security.txt (RFC 9116) and SECURITY.md"
```

---

### Task 3: Create /security Page — Test

**Files:**
- Create: `src/app/security/__tests__/page.test.tsx`

**Step 1: Write the failing test**

Create `src/app/security/__tests__/page.test.tsx`:
```tsx
import { render, screen } from '@testing-library/react';
import SecurityPage from '../page';

describe('SecurityPage', () => {
  it('renders the security heading', () => {
    render(<SecurityPage />);
    expect(screen.getByRole('heading', { level: 1 })).toHaveTextContent('Security');
  });

  it('links to GitHub vulnerability reporting', () => {
    render(<SecurityPage />);
    const link = screen.getByRole('link', { name: /report a vulnerability/i });
    expect(link).toHaveAttribute(
      'href',
      'https://github.com/ThamJiaHe/claudeforge/security/advisories/new'
    );
  });

  it('shows response timeline', () => {
    render(<SecurityPage />);
    expect(screen.getByText(/5 business days/i)).toBeInTheDocument();
    expect(screen.getByText(/90 days/i)).toBeInTheDocument();
  });

  it('defines scope', () => {
    render(<SecurityPage />);
    expect(screen.getByText(/claudeforge\.vercel\.app/i)).toBeInTheDocument();
  });
});
```

**Step 2: Run test to verify it fails**

Run: `npx vitest run src/app/security/__tests__/page.test.tsx`
Expected: FAIL — cannot find module `../page`

---

### Task 4: Create /security Page — Implementation

**Files:**
- Create: `src/app/security/page.tsx`

**Step 1: Implement the security page**

Create `src/app/security/page.tsx`:
```tsx
import type { Metadata } from 'next';
import Link from 'next/link';
import { Shield, ExternalLink, Clock, Target, Heart } from 'lucide-react';

export const metadata: Metadata = {
  title: 'Security',
  description: 'Security vulnerability reporting policy for ClaudeForge',
};

export default function SecurityPage() {
  return (
    <div className="mx-auto max-w-3xl px-4 py-12 sm:px-6">
      {/* Header */}
      <div className="mb-10 flex items-center gap-3">
        <Shield className="size-8 text-muted-foreground" />
        <h1 className="text-3xl font-bold tracking-tight">Security</h1>
      </div>

      {/* Reporting */}
      <section className="mb-10">
        <h2 className="mb-4 text-xl font-semibold">Reporting a Vulnerability</h2>
        <p className="mb-4 text-muted-foreground">
          We take security seriously. If you discover a vulnerability, please follow these steps:
        </p>
        <ol className="mb-4 list-inside list-decimal space-y-2 text-muted-foreground">
          <li>
            Go to our{' '}
            <a
              href="https://github.com/ThamJiaHe/claudeforge/security/advisories/new"
              target="_blank"
              rel="noopener noreferrer"
              className="inline-flex items-center gap-1 font-medium text-foreground underline underline-offset-4 hover:no-underline"
            >
              Report a vulnerability
              <ExternalLink className="size-3" />
            </a>{' '}
            page on GitHub
          </li>
          <li>Provide a clear description of the vulnerability</li>
          <li>Include steps to reproduce if possible</li>
          <li>Allow us time to investigate before public disclosure</li>
        </ol>
        <p className="text-sm text-muted-foreground">
          <strong>Do not</strong> open a public issue for security vulnerabilities.
        </p>
      </section>

      {/* Timeline */}
      <section className="mb-10">
        <div className="flex items-center gap-2">
          <Clock className="size-5 text-muted-foreground" />
          <h2 className="text-xl font-semibold">Response Timeline</h2>
        </div>
        <ul className="mt-4 space-y-2 text-muted-foreground">
          <li>
            <strong>Acknowledgment:</strong> Within 5 business days
          </li>
          <li>
            <strong>Resolution target:</strong> 90 days from report
          </li>
        </ul>
      </section>

      {/* Scope */}
      <section className="mb-10">
        <div className="flex items-center gap-2">
          <Target className="size-5 text-muted-foreground" />
          <h2 className="text-xl font-semibold">Scope</h2>
        </div>
        <div className="mt-4 grid gap-4 sm:grid-cols-2">
          <div>
            <h3 className="mb-2 font-medium text-green-600 dark:text-green-400">In Scope</h3>
            <ul className="list-inside list-disc space-y-1 text-sm text-muted-foreground">
              <li>claudeforge.vercel.app</li>
              <li>GitHub repository code</li>
            </ul>
          </div>
          <div>
            <h3 className="mb-2 font-medium text-red-600 dark:text-red-400">Out of Scope</h3>
            <ul className="list-inside list-disc space-y-1 text-sm text-muted-foreground">
              <li>Third-party services</li>
              <li>Supabase infrastructure</li>
              <li>Vercel platform</li>
            </ul>
          </div>
        </div>
      </section>

      {/* Safe Harbor */}
      <section className="mb-10">
        <div className="flex items-center gap-2">
          <Heart className="size-5 text-muted-foreground" />
          <h2 className="text-xl font-semibold">Safe Harbor</h2>
        </div>
        <p className="mt-4 text-muted-foreground">
          We consider security research conducted in accordance with this policy to be authorized and will not pursue legal action against researchers who follow responsible disclosure practices.
        </p>
      </section>

      {/* Hall of Fame */}
      <section className="mb-10">
        <h2 className="mb-4 text-xl font-semibold">Hall of Fame</h2>
        <p className="text-sm text-muted-foreground">
          No reports yet. Be the first responsible reporter!
        </p>
      </section>

      {/* security.txt note */}
      <section className="border-t pt-6">
        <p className="text-xs text-muted-foreground">
          This site publishes a{' '}
          <Link
            href="/.well-known/security.txt"
            className="underline underline-offset-4 hover:no-underline"
          >
            security.txt
          </Link>{' '}
          file in compliance with{' '}
          <a
            href="https://www.rfc-editor.org/rfc/rfc9116"
            target="_blank"
            rel="noopener noreferrer"
            className="underline underline-offset-4 hover:no-underline"
          >
            RFC 9116
          </a>
          .
        </p>
      </section>
    </div>
  );
}
```

**Step 2: Run tests to verify they pass**

Run: `npx vitest run src/app/security/__tests__/page.test.tsx`
Expected: 4 tests PASS

**Step 3: Commit**

```bash
git add src/app/security/
git commit -m "feat: add /security page with vulnerability reporting policy"
```

---

### Task 5: Install react-kofi and Create Ko-Fi Button

**Files:**
- Modify: `package.json` (add react-kofi)
- Create: `src/components/layout/kofi-button.tsx`

**Step 1: Install react-kofi**

Run:
```bash
npm install react-kofi
```
Expected: Clean install

**Step 2: Create Ko-Fi button component**

Create `src/components/layout/kofi-button.tsx`:
```tsx
'use client';

import { KofiButton as KofiBtn } from 'react-kofi';
import 'react-kofi/dist/button.css';

export function KofiButton() {
  return (
    <KofiBtn
      username="thamjiahe"
      label="Support"
      preset="thin"
      backgroundColor="kofiGrey"
    />
  );
}
```

**Step 3: Verify build**

Run: `npx next build 2>&1 | head -20`
Expected: Build succeeds (or at least no import errors for react-kofi)

**Step 4: Commit**

```bash
git add package.json package-lock.json src/components/layout/kofi-button.tsx
git commit -m "feat: add Ko-Fi support button component"
```

---

### Task 6: Create Ko-Fi Floating Widget

**Files:**
- Create: `src/components/layout/kofi-widget.tsx`
- Modify: `src/app/layout.tsx`

**Step 1: Create floating widget component**

Create `src/components/layout/kofi-widget.tsx`:
```tsx
'use client';

import { FloatingWidget } from 'react-kofi';
import 'react-kofi/dist/widget.css';

export function KofiWidget() {
  return (
    <FloatingWidget
      username="thamjiahe"
      attachOnScroll={true}
    />
  );
}
```

**Step 2: Add widget to root layout**

In `src/app/layout.tsx`, add import:
```tsx
import { KofiWidget } from '@/components/layout/kofi-widget';
```

Add `<KofiWidget />` inside ThemeProvider, after the `<Toaster />`:
```tsx
<Toaster />
<KofiWidget />
<SpeedInsights />
```

**Step 3: Verify build**

Run: `npx next build 2>&1 | head -20`
Expected: Build succeeds

**Step 4: Commit**

```bash
git add src/components/layout/kofi-widget.tsx src/app/layout.tsx
git commit -m "feat: add Ko-Fi floating widget to all pages"
```

---

### Task 7: Redesign Footer — Test

**Files:**
- Create: `src/components/layout/__tests__/footer.test.tsx`

**Step 1: Write the failing test**

Create `src/components/layout/__tests__/footer.test.tsx`:
```tsx
import { render, screen } from '@testing-library/react';
import { Footer } from '../footer';

// Mock next/link
vi.mock('next/link', () => ({
  default: ({ children, href, ...props }: any) => (
    <a href={href} {...props}>{children}</a>
  ),
}));

describe('Footer', () => {
  it('renders three column headings', () => {
    render(<Footer />);
    expect(screen.getByText('Product')).toBeInTheDocument();
    expect(screen.getByText('Community')).toBeInTheDocument();
    expect(screen.getByText('Legal & Security')).toBeInTheDocument();
  });

  it('links to /security', () => {
    render(<Footer />);
    const link = screen.getByRole('link', { name: /security/i });
    expect(link).toHaveAttribute('href', '/security');
  });

  it('links to /changelog', () => {
    render(<Footer />);
    const link = screen.getByRole('link', { name: /changelog/i });
    expect(link).toHaveAttribute('href', '/changelog');
  });

  it('shows version number', () => {
    render(<Footer />);
    expect(screen.getByText(/v\d+\.\d+\.\d+/)).toBeInTheDocument();
  });

  it('shows branding text', () => {
    render(<Footer />);
    expect(screen.getByText(/built with/i)).toBeInTheDocument();
  });
});
```

**Step 2: Run test to verify it fails**

Run: `npx vitest run src/components/layout/__tests__/footer.test.tsx`
Expected: FAIL — missing 'Product', 'Community', 'Legal & Security' headings

---

### Task 8: Redesign Footer — Implementation

**Files:**
- Modify: `src/components/layout/footer.tsx`

**Step 1: Rewrite footer with 3-column layout**

Replace entire content of `src/components/layout/footer.tsx`:
```tsx
import Link from 'next/link';
import { Github } from 'lucide-react';
import { APP_VERSION } from '@/lib/constants';
import { KofiButton } from './kofi-button';

const footerLinks = {
  product: [
    { label: 'Home', href: '/' },
    { label: 'Docs', href: '/docs' },
    { label: 'History', href: '/history' },
    { label: 'Changelog', href: '/changelog' },
  ],
  community: [
    { label: 'GitHub', href: 'https://github.com/ThamJiaHe/claudeforge', external: true },
    { label: 'Issues', href: 'https://github.com/ThamJiaHe/claudeforge/issues', external: true },
    { label: 'Contribute', href: 'https://github.com/ThamJiaHe/claudeforge/blob/main/README.md', external: true },
  ],
  legal: [
    { label: 'Security', href: '/security' },
    { label: 'Privacy', href: 'https://github.com/ThamJiaHe/claudeforge', external: true },
    { label: 'License (MIT)', href: 'https://github.com/ThamJiaHe/claudeforge/blob/main/LICENSE', external: true },
  ],
};

function FooterColumn({ title, links }: { title: string; links: typeof footerLinks.product }) {
  return (
    <div>
      <h3 className="mb-3 text-sm font-semibold">{title}</h3>
      <ul className="space-y-2">
        {links.map((link) => (
          <li key={link.label}>
            {link.external ? (
              <a
                href={link.href}
                target="_blank"
                rel="noopener noreferrer"
                className="text-sm text-muted-foreground transition-colors hover:text-foreground"
              >
                {link.label}
              </a>
            ) : (
              <Link
                href={link.href}
                className="text-sm text-muted-foreground transition-colors hover:text-foreground"
              >
                {link.label}
              </Link>
            )}
          </li>
        ))}
      </ul>
    </div>
  );
}

export function Footer() {
  return (
    <footer className="border-t">
      {/* Column links */}
      <div className="container mx-auto grid grid-cols-1 gap-8 px-4 py-8 sm:grid-cols-3">
        <FooterColumn title="Product" links={footerLinks.product} />
        <FooterColumn title="Community" links={footerLinks.community} />
        <FooterColumn title="Legal & Security" links={footerLinks.legal} />
      </div>

      {/* Bottom bar */}
      <div className="border-t">
        <div className="container mx-auto flex flex-wrap items-center justify-between gap-3 px-4 py-4">
          <p className="text-xs text-muted-foreground">
            Built with &#9829; and Claude
          </p>
          <div className="flex items-center gap-3">
            <KofiButton />
            <a
              href="https://github.com/ThamJiaHe/claudeforge"
              target="_blank"
              rel="noopener noreferrer"
              className="text-muted-foreground transition-colors hover:text-foreground"
              aria-label="GitHub repository"
            >
              <Github className="size-4" />
            </a>
            <span className="text-xs text-muted-foreground">v{APP_VERSION}</span>
          </div>
        </div>
      </div>
    </footer>
  );
}
```

**Step 2: Run tests to verify they pass**

Run: `npx vitest run src/components/layout/__tests__/footer.test.tsx`
Expected: 5 tests PASS

**Step 3: Commit**

```bash
git add src/components/layout/footer.tsx src/components/layout/__tests__/footer.test.tsx
git commit -m "feat: redesign footer with 3-column layout and Ko-Fi button"
```

---

### Task 9: Create /changelog Page — Test

**Files:**
- Create: `src/app/changelog/__tests__/page.test.tsx`

**Step 1: Write the failing test**

Create `src/app/changelog/__tests__/page.test.tsx`:
```tsx
import { render, screen } from '@testing-library/react';
import ChangelogPage from '../page';

describe('ChangelogPage', () => {
  it('renders the changelog heading', () => {
    render(<ChangelogPage />);
    expect(screen.getByRole('heading', { level: 1 })).toHaveTextContent('Changelog');
  });

  it('shows v0.2.0 entry', () => {
    render(<ChangelogPage />);
    expect(screen.getByText(/v0\.2\.0/)).toBeInTheDocument();
  });

  it('shows v0.1.0 entry', () => {
    render(<ChangelogPage />);
    expect(screen.getByText(/v0\.1\.0/)).toBeInTheDocument();
  });

  it('renders category badges', () => {
    render(<ChangelogPage />);
    const featBadges = screen.getAllByText('feat');
    expect(featBadges.length).toBeGreaterThan(0);
  });
});
```

**Step 2: Run test to verify it fails**

Run: `npx vitest run src/app/changelog/__tests__/page.test.tsx`
Expected: FAIL — cannot find module `../page`

---

### Task 10: Create /changelog Page — Implementation

**Files:**
- Create: `src/app/changelog/page.tsx`

**Step 1: Implement the changelog page**

Create `src/app/changelog/page.tsx`:
```tsx
import type { Metadata } from 'next';
import { FileText } from 'lucide-react';

export const metadata: Metadata = {
  title: 'Changelog',
  description: 'ClaudeForge release history and version changes',
};

type ChangeCategory = 'feat' | 'fix' | 'docs' | 'chore';

interface ChangeEntry {
  category: ChangeCategory;
  description: string;
  commit?: string;
}

interface VersionEntry {
  version: string;
  date: string;
  changes: ChangeEntry[];
}

const categoryColors: Record<ChangeCategory, string> = {
  feat: 'bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400',
  fix: 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400',
  docs: 'bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400',
  chore: 'bg-gray-100 text-gray-800 dark:bg-gray-800/50 dark:text-gray-400',
};

const changelog: VersionEntry[] = [
  {
    version: '0.3.0',
    date: '2026-02-27',
    changes: [
      { category: 'feat', description: 'Security vulnerability reporting page and security.txt' },
      { category: 'feat', description: 'Ko-Fi donation integration with floating widget' },
      { category: 'feat', description: 'Redesigned footer with 3-column layout' },
      { category: 'feat', description: 'Changelog page' },
      { category: 'feat', description: 'GitHub star badge in header' },
      { category: 'fix', description: 'Mobile config bar spacing improvements' },
      { category: 'fix', description: 'Docs "Back to top" now scrolls instead of navigating' },
      { category: 'feat', description: 'Header nav active state indicator' },
    ],
  },
  {
    version: '0.2.0',
    date: '2026-02-26',
    changes: [
      { category: 'feat', description: 'Multi-provider support with 7 AI providers', commit: '6972e8d' },
      { category: 'fix', description: 'Resolve Gemini "Model not found" error', commit: '2f7520c' },
      { category: 'fix', description: 'Store API keys per-provider', commit: '4cff1c3' },
      { category: 'fix', description: 'Resolve provider routing bug and improve auth error handling', commit: '3873f19' },
      { category: 'fix', description: 'Improve error diagnostics and auth resilience', commit: 'c911a14' },
    ],
  },
  {
    version: '0.1.0',
    date: '2026-02-25',
    changes: [
      { category: 'feat', description: 'Initial release with prompt generation engine' },
      { category: 'feat', description: 'Claude, GPT, Gemini, Llama target support' },
      { category: 'feat', description: '9 output formats (XML, TOON, Markdown, JSON, etc.)' },
      { category: 'feat', description: 'Prompt history with Supabase sync' },
      { category: 'feat', description: 'GitHub OAuth authentication' },
      { category: 'feat', description: 'Dark/light theme toggle' },
      { category: 'docs', description: 'Comprehensive docs page' },
    ],
  },
];

function Badge({ category }: { category: ChangeCategory }) {
  return (
    <span
      className={`inline-block rounded-full px-2 py-0.5 text-xs font-medium ${categoryColors[category]}`}
    >
      {category}
    </span>
  );
}

export default function ChangelogPage() {
  return (
    <div className="mx-auto max-w-3xl px-4 py-12 sm:px-6">
      <div className="mb-10 flex items-center gap-3">
        <FileText className="size-8 text-muted-foreground" />
        <h1 className="text-3xl font-bold tracking-tight">Changelog</h1>
      </div>

      <div className="space-y-12">
        {changelog.map((entry) => (
          <section key={entry.version}>
            <div className="mb-4 flex items-baseline gap-3">
              <h2 className="text-xl font-semibold">v{entry.version}</h2>
              <time className="text-sm text-muted-foreground">{entry.date}</time>
            </div>
            <ul className="space-y-2">
              {entry.changes.map((change, i) => (
                <li key={i} className="flex items-start gap-2">
                  <Badge category={change.category} />
                  <span className="text-sm text-muted-foreground">
                    {change.description}
                    {change.commit && (
                      <>
                        {' '}
                        <a
                          href={`https://github.com/ThamJiaHe/claudeforge/commit/${change.commit}`}
                          target="_blank"
                          rel="noopener noreferrer"
                          className="font-mono text-xs text-muted-foreground/60 hover:text-foreground"
                        >
                          {change.commit.slice(0, 7)}
                        </a>
                      </>
                    )}
                  </span>
                </li>
              ))}
            </ul>
          </section>
        ))}
      </div>
    </div>
  );
}
```

**Step 2: Run tests to verify they pass**

Run: `npx vitest run src/app/changelog/__tests__/page.test.tsx`
Expected: 4 tests PASS

**Step 3: Commit**

```bash
git add src/app/changelog/
git commit -m "feat: add /changelog page with version history"
```

---

### Task 11: Create GitHub Stars Component — Test

**Files:**
- Create: `src/components/layout/__tests__/github-stars.test.tsx`

**Step 1: Write the failing test**

Create `src/components/layout/__tests__/github-stars.test.tsx`:
```tsx
import { render, screen } from '@testing-library/react';
import { GitHubStars } from '../github-stars';

describe('GitHubStars', () => {
  beforeEach(() => {
    vi.stubGlobal('fetch', vi.fn());
  });

  afterEach(() => {
    vi.restoreAllMocks();
  });

  it('renders a link to the GitHub repo', () => {
    (globalThis.fetch as any).mockResolvedValueOnce({
      ok: true,
      json: async () => ({ stargazers_count: 42 }),
    });
    render(<GitHubStars />);
    const link = screen.getByRole('link');
    expect(link).toHaveAttribute('href', 'https://github.com/ThamJiaHe/claudeforge');
  });

  it('shows star icon', () => {
    (globalThis.fetch as any).mockResolvedValueOnce({
      ok: true,
      json: async () => ({ stargazers_count: 10 }),
    });
    render(<GitHubStars />);
    // Star icon should be present (as svg)
    expect(screen.getByRole('link')).toBeInTheDocument();
  });
});
```

**Step 2: Run test to verify it fails**

Run: `npx vitest run src/components/layout/__tests__/github-stars.test.tsx`
Expected: FAIL — cannot find module `../github-stars`

---

### Task 12: Create GitHub Stars Component — Implementation

**Files:**
- Create: `src/components/layout/github-stars.tsx`

**Step 1: Implement the GitHub stars component**

Create `src/components/layout/github-stars.tsx`:
```tsx
'use client';

import { useEffect, useState } from 'react';
import { Star } from 'lucide-react';

const REPO = 'ThamJiaHe/claudeforge';
const CACHE_KEY = 'github-stars';
const CACHE_TTL = 1000 * 60 * 60; // 1 hour

export function GitHubStars() {
  const [stars, setStars] = useState<number | null>(null);

  useEffect(() => {
    // Check cache first
    const cached = localStorage.getItem(CACHE_KEY);
    if (cached) {
      const { count, timestamp } = JSON.parse(cached);
      if (Date.now() - timestamp < CACHE_TTL) {
        setStars(count);
        return;
      }
    }

    fetch(`https://api.github.com/repos/${REPO}`)
      .then((res) => {
        if (!res.ok) throw new Error('GitHub API error');
        return res.json();
      })
      .then((data) => {
        const count = data.stargazers_count ?? 0;
        setStars(count);
        localStorage.setItem(CACHE_KEY, JSON.stringify({ count, timestamp: Date.now() }));
      })
      .catch(() => {
        // Graceful fallback: show nothing
        setStars(null);
      });
  }, []);

  return (
    <a
      href={`https://github.com/${REPO}`}
      target="_blank"
      rel="noopener noreferrer"
      className="flex items-center gap-1 rounded-md px-1.5 py-1 text-xs text-muted-foreground transition-colors hover:text-foreground"
      aria-label="Star on GitHub"
    >
      <Star className="size-3.5" />
      {stars !== null && <span>{stars}</span>}
    </a>
  );
}
```

**Step 2: Run tests to verify they pass**

Run: `npx vitest run src/components/layout/__tests__/github-stars.test.tsx`
Expected: 2 tests PASS

**Step 3: Commit**

```bash
git add src/components/layout/github-stars.tsx src/components/layout/__tests__/github-stars.test.tsx
git commit -m "feat: add GitHub star badge component with client-side caching"
```

---

### Task 13: Update Header — Changelog Link, Star Badge, Active Nav

**Files:**
- Modify: `src/components/layout/header.tsx`

**Step 1: Rewrite header with additions**

Update `src/components/layout/header.tsx`:
```tsx
'use client';

import Link from 'next/link';
import { usePathname } from 'next/navigation';
import { APP_NAME } from '@/lib/constants';
import { ThemeToggle } from '@/components/theme-toggle';
import { AuthButton } from '@/components/auth/auth-button';
import { GitHubStars } from './github-stars';

const navLinks = [
  { href: '/history', label: 'History' },
  { href: '/docs', label: 'Docs' },
  { href: '/changelog', label: 'Changelog' },
];

export function Header() {
  const pathname = usePathname();

  return (
    <header
      role="banner"
      className="sticky top-0 z-50 w-full border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60"
    >
      <div className="container mx-auto flex h-14 items-center justify-between px-3 sm:px-4">
        {/* Left: Logo */}
        <Link href="/" className="flex shrink-0 items-center gap-2">
          <span className="text-base font-bold tracking-tight sm:text-lg">{APP_NAME}</span>
        </Link>

        {/* Right: Nav + Actions */}
        <div className="flex items-center gap-0.5 sm:gap-1">
          <nav aria-label="Main navigation" className="flex items-center gap-0.5 sm:gap-1">
            {navLinks.map((link) => {
              const isActive = pathname === link.href;
              return (
                <Link
                  key={link.href}
                  href={link.href}
                  className={`rounded-md px-2 py-1.5 text-xs font-medium transition-colors sm:px-3 sm:py-2 sm:text-sm ${
                    isActive
                      ? 'text-foreground underline underline-offset-4'
                      : 'text-muted-foreground hover:text-foreground'
                  }`}
                >
                  {link.label}
                </Link>
              );
            })}
          </nav>

          <GitHubStars />
          <ThemeToggle />
          <AuthButton />
        </div>
      </div>
    </header>
  );
}
```

**Step 2: Verify build**

Run: `npx next build 2>&1 | head -20`
Expected: Build succeeds

**Step 3: Commit**

```bash
git add src/components/layout/header.tsx
git commit -m "feat: add Changelog nav, GitHub stars badge, and active nav state to header"
```

---

### Task 14: Fix Mobile Config Bar Spacing

**Files:**
- Modify: `src/components/forge/config-bar.tsx:16`

**Step 1: Update gap values for mobile breathing room**

In `src/components/forge/config-bar.tsx`, change line 16 from:
```tsx
className="grid grid-cols-2 items-end gap-3 rounded-lg bg-muted/50 p-3 sm:gap-4 sm:p-4 md:grid-cols-3 lg:flex lg:flex-wrap"
```
to:
```tsx
className="grid grid-cols-2 items-end gap-4 rounded-lg bg-muted/50 p-4 sm:gap-4 sm:p-4 md:grid-cols-3 lg:flex lg:flex-wrap"
```

This increases mobile `gap-3 p-3` to `gap-4 p-4` for more breathing room.

**Step 2: Verify build**

Run: `npx next build 2>&1 | head -20`
Expected: Build succeeds

**Step 3: Commit**

```bash
git add src/components/forge/config-bar.tsx
git commit -m "fix: improve mobile config bar spacing"
```

---

### Task 15: Fix Docs "Back to Top" Link

**Files:**
- Modify: `src/app/docs/page.tsx:494-499`

**Step 1: Change Link to button with scroll behavior**

In `src/app/docs/page.tsx`, replace the Back to top section (lines 493-500):

From:
```tsx
<Link
  href="/docs"
  className="text-sm text-muted-foreground transition-colors hover:text-foreground"
>
  Back to top
</Link>
```

To:
```tsx
<button
  type="button"
  onClick={() => window.scrollTo({ top: 0, behavior: 'smooth' })}
  className="text-sm text-muted-foreground transition-colors hover:text-foreground"
>
  Back to top
</button>
```

Also remove the `Link` import if it's only used here (check first — it may be used elsewhere on the page).

**Step 2: Verify build**

Run: `npx next build 2>&1 | head -20`
Expected: Build succeeds

**Step 3: Commit**

```bash
git add src/app/docs/page.tsx
git commit -m "fix: docs 'Back to top' now scrolls instead of navigating"
```

---

### Task 16: Consistent Page Padding

**Files:**
- Modify: `src/app/security/page.tsx` (already uses max-w-3xl)
- Modify: `src/app/changelog/page.tsx` (already uses max-w-3xl)
- Verify: `src/app/docs/page.tsx`, `src/app/history/page.tsx`

**Step 1: Audit and align max-width classes**

Check all page files use consistent `mx-auto max-w-3xl px-4 sm:px-6` or their appropriate variant. The new pages (security, changelog) already use this. Verify docs and history match.

Run: `grep -n "max-w-" src/app/*/page.tsx`
Expected: All pages use consistent max-width

**Step 2: Fix any inconsistencies found**

Adjust any pages that don't match the pattern. Likely no changes needed if existing pages already use container classes.

**Step 3: Commit (if changes)**

```bash
git add -A
git commit -m "fix: align page padding across all routes"
```

---

### Task 17: Version Bump and Final Verification

**Files:**
- Modify: `src/lib/constants.ts:36`

**Step 1: Bump version to 0.3.0**

In `src/lib/constants.ts`, change:
```ts
export const APP_VERSION = '0.2.0';
```
to:
```ts
export const APP_VERSION = '0.3.0';
```

**Step 2: Run all tests**

Run: `npx vitest run`
Expected: All tests PASS

**Step 3: Run full build**

Run: `npx next build`
Expected: Build succeeds with no errors

**Step 4: Commit**

```bash
git add src/lib/constants.ts
git commit -m "chore: bump version to v0.3.0"
```

---

## Summary

| Task | Description | Files |
|------|-------------|-------|
| 1 | Test infrastructure setup | vitest.config.ts, setup.ts |
| 2 | security.txt + SECURITY.md | public/.well-known/, SECURITY.md |
| 3-4 | /security page (test + impl) | src/app/security/ |
| 5 | Ko-Fi button component | kofi-button.tsx |
| 6 | Ko-Fi floating widget | kofi-widget.tsx, layout.tsx |
| 7-8 | Footer redesign (test + impl) | footer.tsx |
| 9-10 | /changelog page (test + impl) | src/app/changelog/ |
| 11-12 | GitHub stars (test + impl) | github-stars.tsx |
| 13 | Header updates | header.tsx |
| 14 | Mobile config bar fix | config-bar.tsx |
| 15 | Docs back-to-top fix | docs/page.tsx |
| 16 | Consistent page padding | multiple |
| 17 | Version bump + verify | constants.ts |

**Total commits:** ~14
**New dependencies:** `react-kofi`, `@testing-library/react`, `@testing-library/jest-dom`, `jsdom` (dev)
